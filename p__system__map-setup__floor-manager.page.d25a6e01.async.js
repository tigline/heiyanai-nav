"use strict";(self.webpackChunkheyanai_navigation=self.webpackChunkheyanai_navigation||[]).push([[114],{51042:function(Y,I,e){var _=e(1413),g=e(67294),h=e(42110),E=e(98615),O=function(v,f){return g.createElement(E.Z,(0,_.Z)((0,_.Z)({},v),{},{ref:f,icon:h.Z}))};O.displayName="PlusOutlined",I.Z=g.forwardRef(O)},31199:function(Y,I,e){var _=e(1413),g=e(91),h=e(67294),E=e(86682),O=e(85893),s=["fieldProps","min","proFieldProps","max"],v=function(i,D){var Z=i.fieldProps,j=i.min,L=i.proFieldProps,F=i.max,C=(0,g.Z)(i,s);return(0,O.jsx)(E.Z,(0,_.Z)({valueType:"digit",fieldProps:(0,_.Z)({min:j,max:F},Z),ref:D,filedConfig:{defaultProps:{width:"100%"}},proFieldProps:L},C))},f=h.forwardRef(v);I.Z=f},88923:function(Y,I,e){e.d(I,{h:function(){return F}});var _=e(97857),g=e.n(_),h=e(15009),E=e.n(h),O=e(99289),s=e.n(O),v=e(59061),f=e(35312),R=e(69400),i=e(90156),D=e(96486),Z=e.n(D),j=e(491),L=e(85893);function F(C){var S=(0,f.useIntl)();return(0,L.jsx)(v.Z,g()(g()({accept:"image/png",max:1,transform:function(a){var T,A,U={};return(0,D.set)(U,(T=C.name)!==null&&T!==void 0?T:"picture",(A=(0,D.first)(a))===null||A===void 0?void 0:A.response),U}},C),{},{fieldProps:{listType:"picture-card",onPreview:function(a){R.Z.warning({content:(0,L.jsx)(i.Z,{width:600,src:a.thumbUrl}),width:660-12,icon:" "})},customRequest:function(){var B=s()(E()().mark(function T(A){var U,K,$,z;return E()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return U=A.file,K=new FormData,K.append("file",U),M.prev=3,M.next=6,(0,j.cT)(K);case 6:z=M.sent,console.log(z),($=A.onSuccess)===null||$===void 0||$.call(A,z.data.url),M.next=14;break;case 11:M.prev=11,M.t0=M.catch(3),console.log(M.t0);case 14:case"end":return M.stop()}},T,null,[[3,11]])}));function a(T){return B.apply(this,arguments)}return a}()}}))}},89512:function(Y,I,e){e.d(I,{v:function(){return O}});var _=e(35312),g=e(86738),h=e(71577),E=e(85893);function O(s){var v,f,R,i,D=(0,_.useIntl)();return(0,E.jsx)(g.Z,{title:(v=s.title)!==null&&v!==void 0?v:D.formatMessage({id:"app.remove.confirm.title",defaultMessage:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u6B64\u9879\u5417?"}),description:(f=s.title)!==null&&f!==void 0?f:D.formatMessage({id:"app.remove.confirm.description",defaultMessage:"\u5220\u9664\u6B64\u9879"}),okButtonProps:{loading:s.loading},getPopupContainer:s.getPopupContainer,onConfirm:function(){var j;return s==null||(j=s.onClick)===null||j===void 0?void 0:j.call(s)},children:!s.children&&(0,E.jsx)(h.ZP,{type:(R=s.type)!==null&&R!==void 0?R:"link",size:(i=s.size)!==null&&i!==void 0?i:"small",disabled:s.disabled,children:(0,E.jsx)(_.FormattedMessage,{id:"app.remove",defaultMessage:"\u5220\u9664"})})})}},69688:function(Y,I,e){e.r(I),e.d(I,{default:function(){return q}});var _=e(89512),g=e(491),h=e(69851),E=e(90930),O=e(9455),s=e(35312),v=e(54689),f=e(71577),R=e(97857),i=e.n(R),D=e(5574),Z=e.n(D),j=e(88923),L=e(51042),F=e(37476),C=e(5966),S=e(31199),B=e(12029),a=e(85893);function T(n){var t=(0,s.useIntl)(),d=n.buildingId,r=B.Z.useForm(),p=Z()(r,1),l=p[0],x=(0,s.useModel)("mapModel"),P=x.run;return(0,a.jsxs)(F.Y,{title:(0,a.jsx)(s.FormattedMessage,{id:"pages.system.map-setup.map.add",defaultMessage:"\u6DFB\u52A0\u5730\u56FE"}),layout:"horizontal",form:l,labelCol:{xs:6},wrapperCol:{xs:16},disabled:!d,modalProps:{destroyOnClose:!0,onCancel:function(){return console.log("run")}},onFinish:function(m){return(0,g.JY)(i()(i()({},m),{},{buildingId:d})).then(function(c){var u;return(u=n.refresh)===null||u===void 0||u.call(n),P(!0),v.Z.success({message:t.formatMessage({id:"app.add.success",defaultMessage:"\u65B0\u5EFA\u6210\u529F"})}),c.code===h.OK})},trigger:(0,a.jsxs)(f.ZP,{type:"primary",children:[(0,a.jsx)(L.Z,{}),t.formatMessage({id:"app.add",defaultMessage:"\u65B0\u5EFA"})]}),children:[(0,a.jsx)(C.Z,{width:"lg",name:"name",label:t.formatMessage({id:"pages.system.map-setup.map.name",defaultMessage:"\u5730\u56FE\u540D\u79F0"}),rules:[{required:!0,message:t.formatMessage({id:"pages.system.map-setup.map.name.required.failure",defaultMessage:"\u5EFA\u7B51\u540D\u5FC5\u586B"})}]}),(0,a.jsx)(C.Z,{width:"lg",name:"floor",label:t.formatMessage({id:"pages.system.map-setup.map.floor",defaultMessage:"\u697C\u5C42"}),rules:[{required:!0,message:t.formatMessage({id:"pages.system.map-setup.map.floor.required.failure",defaultMessage:"\u697C\u5C42\u5FC5\u586B"})}]}),(0,a.jsx)(S.Z,{width:"lg",name:"width",label:t.formatMessage({id:"pages.system.map-setup.map.width",defaultMessage:"\u5B9E\u9645\u5BBD\u5EA6"}),addonAfter:t.formatMessage({id:"app.unit.m",defaultMessage:"\u7C73"}),rules:[{required:!0,message:t.formatMessage({id:"pages.system.map-setup.map.width.required.failure",defaultMessage:"\u5B9E\u9645\u5BBD\u5EA6\u5FC5\u586B"})}]}),(0,a.jsx)(S.Z,{width:"lg",name:"length",addonAfter:t.formatMessage({id:"app.unit.m",defaultMessage:"\u7C73"}),label:t.formatMessage({id:"pages.system.map-setup.map.length",defaultMessage:"\u5B9E\u9645\u957F\u5EA6"}),rules:[{required:!0,message:t.formatMessage({id:"pages.system.map-setup.map.length.required.failure",defaultMessage:"\u5B9E\u9645\u957F\u5EA6\u5FC5\u586B"})}]}),(0,a.jsx)(j.h,{width:"lg",name:"picture",label:t.formatMessage({id:"pages.system.map-setup.building.picture",defaultMessage:"\u793A\u610F\u56FE"}),rules:[{required:!0,message:t.formatMessage({id:"pages.system.map-setup.building.address.required.failure",defaultMessage:"\u793A\u610F\u56FE\u5FC5\u586B"})}]})]})}function A(n){var t,d,r=(0,s.useIntl)(),p=n.record,l=p.buildingId,x=p.mapId,P=B.Z.useForm(),o=Z()(P,1),m=o[0],c=(0,s.useModel)("mapModel"),u=c.run;return(0,a.jsxs)(F.Y,{title:(0,a.jsx)(s.FormattedMessage,{id:"pages.system.map-setup.map.edit",defaultMessage:"\u6DFB\u52A0\u5730\u56FE"}),layout:"horizontal",form:m,labelCol:{xs:6},wrapperCol:{xs:16},disabled:!l,modalProps:{destroyOnClose:!0,onCancel:function(){return console.log("run")}},onFinish:function(V){return(0,g.sA)({mapId:x},i()(i()({},V),{},{buildingId:l})).then(function(W){if(W.code===h.OK){var J;(J=n.refresh)===null||J===void 0||J.call(n),u(!0),v.Z.success({message:r.formatMessage({id:"app.edit.success",defaultMessage:"\u66F4\u65B0\u6210\u529F"})})}return W.code===h.OK})},trigger:(0,a.jsx)(f.ZP,{type:"link",size:"small",children:r.formatMessage({id:"app.edit",defaultMessage:"\u7F16\u8F91"})}),children:[(0,a.jsx)(C.Z,{width:"lg",name:"name",initialValue:n.record.name,label:r.formatMessage({id:"pages.system.map-setup.map.name",defaultMessage:"\u5730\u56FE\u540D\u79F0"}),rules:[{required:!0,message:r.formatMessage({id:"pages.system.map-setup.map.name.required.failure",defaultMessage:"\u5730\u56FE\u540D\u5FC5\u586B"})}]}),(0,a.jsx)(C.Z,{width:"lg",name:"floor",initialValue:n.record.floor,label:r.formatMessage({id:"pages.system.map-setup.map.floor",defaultMessage:"\u697C\u5C42"}),rules:[{required:!0,message:r.formatMessage({id:"pages.system.map-setup.map.floor.required.failure",defaultMessage:"\u697C\u5C42\u5FC5\u586B"})}]}),(0,a.jsx)(S.Z,{width:"lg",name:"width",initialValue:n.record.width,label:r.formatMessage({id:"pages.system.map-setup.map.width",defaultMessage:"\u5B9E\u9645\u5BBD\u5EA6"}),addonAfter:r.formatMessage({id:"app.unit.m",defaultMessage:"\u7C73"}),rules:[{required:!0,message:r.formatMessage({id:"pages.system.map-setup.map.width.required.failure",defaultMessage:"\u5B9E\u9645\u5BBD\u5EA6\u5FC5\u586B"})}]}),(0,a.jsx)(S.Z,{width:"lg",name:"length",initialValue:n.record.length,label:r.formatMessage({id:"pages.system.map-setup.map.length",defaultMessage:"\u5B9E\u9645\u957F\u5EA6"}),addonAfter:r.formatMessage({id:"app.unit.m",defaultMessage:"\u7C73"}),rules:[{required:!0,message:r.formatMessage({id:"pages.system.map-setup.map.length.required.failure",defaultMessage:"\u5B9E\u9645\u957F\u5EA6\u5FC5\u586B"})}]}),(0,a.jsx)(j.h,{width:"lg",name:"picture",initialValue:[{uid:Date.now()+"",response:(t=n.record)===null||t===void 0?void 0:t.picture,thumbUrl:(d=n.record)===null||d===void 0?void 0:d.picture}],label:r.formatMessage({id:"pages.system.map-setup.building.picture",defaultMessage:"\u793A\u610F\u56FE"}),rules:[{required:!0,message:r.formatMessage({id:"pages.system.map-setup.building.picture.required.failure",defaultMessage:"\u793A\u610F\u56FE\u5FC5\u586B"})}]})]})}var U=e(19632),K=e.n(U),$=e(87888),z=e(32240),H=e(45968),M=e(30692),G=e(62466),Q=e(4393),b=e(67294),N=e(67058);function X(n){var t,d=Z()(n.rect,2),r=d[0],p=d[1],l=b.useState(),x=Z()(l,2),P=x[0],o=x[1],m=b.useRef(null),c=b.useRef(),u=b.useRef();return b.useEffect(function(){var y;c.current=new G.Scene({id:m.current,map:new G.Mapbox({style:"blank",center:[0,0],pitch:0,zoom:20,minZoom:18})}),c.current.addImage("stationIcon",H.Z),c.current.addImage("arrow",$.Z),c.current.addImage("personImage",z.Z),c.current.addImage("warning",M.Z),(y=c.current)===null||y===void 0||y.on("loaded",function(){return o(!0)})},[]),b.useEffect(function(){if(n.map&&P&&p&&r){var y=(0,G.metersToLngLat)([r*N.bA,p*N.bA]);if(u.current)u.current.setData(n.map,{parser:{type:"image",extent:[0,0].concat(K()(y))}}),u.current.setIndex(0);else{var V,W;u.current=new G.ImageLayer({zIndex:0}),u.current.source(n.map,{parser:{type:"image",extent:[0,0].concat(K()(y))}}),(V=c.current)===null||V===void 0||V.setCenter([y[0]/2,y[1]/2]),(W=c.current)===null||W===void 0||W.addLayer(u.current)}}},[n.map,P,p,r]),(0,a.jsx)(b.Fragment,{children:(0,a.jsx)(Q.Z,{bodyStyle:{padding:0},children:(0,a.jsx)("div",{id:"map",ref:m,style:{minHeight:(t=n.height)!==null&&t!==void 0?t:600}})})})}function w(n){var t=(0,s.useIntl)(),d=(0,s.useModel)("mapModel"),r=d.run,p=d.data;b.useEffect(function(){r()},[]);var l=p==null?void 0:p.find(function(x){return x.mapId===n.record.mapId});return(0,a.jsx)(F.Y,{title:t.formatMessage({id:"pages.system.map-setup.map.view",defaultMessage:"\u67E5\u770B\u5730\u56FE"}),submitter:!1,trigger:(0,a.jsx)(f.ZP,{type:"link",size:"small",children:(0,a.jsx)(s.FormattedMessage,{id:"app.view",defaultMessage:"\u9884\u89C8"})}),children:(0,a.jsx)(X,{map:l==null?void 0:l.picture,rect:[l==null?void 0:l.length,l==null?void 0:l.width]})})}function q(){var n=(0,s.useMatch)("/system/map-setup/floor-manager.page/:buildingId"),t=n==null?void 0:n.params.buildingId,d=(0,s.useIntl)(),r=(0,s.useRequest)(g.yJ,{manual:!0,fetchKey:function(o){return o.mapId},onSuccess:function(o){o&&v.Z.success({message:d.formatMessage({id:"app.remove.success",defaultMessage:"\u5220\u9664\u6210\u529F"})})}}),p=r.run,l=r.loading,x=[{title:d.formatMessage({id:"pages.system.map-setup.map.name",defaultMessage:"\u5730\u56FE\u540D\u79F0"}),dataIndex:"name"},{title:d.formatMessage({id:"pages.system.map-setup.map.floor",defaultMessage:"\u697C\u5C42"}),dataIndex:"floor"},{title:d.formatMessage({id:"pages.system.map-setup.map.id",defaultMessage:"\u552F\u4E00\u6807\u8BC6"}),search:!1,dataIndex:"mapId"},{title:d.formatMessage({id:"app.action",defaultMessage:"\u64CD\u4F5C"}),valueType:"option",key:"option",render:function(o,m,c,u){return(0,a.jsxs)(f.ZP.Group,{children:[(0,a.jsx)(A,{disabled:!m.mapId,record:m}),(0,a.jsx)(w,{record:m}),(0,a.jsx)(_.v,{disabled:!m.mapId,loading:l,onClick:function(){return p({mapId:m.mapId}).then(function(){u==null||u.reload()})}})]})}}];return(0,a.jsx)(E._z,{children:(0,a.jsx)(O.Z,{options:{setting:!1},pagination:!1,columns:x,toolBarRender:function(o){return[(0,a.jsx)(T,{buildingId:t,refresh:o==null?void 0:o.reload},"add")]},request:function(o){return(0,g.pl)({buildingId:t,name:o.name}).then(function(m){return{data:m.data,success:m.code===h.OK}})}})})}}}]);
