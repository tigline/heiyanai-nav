"use strict";(self.webpackChunkheyanai_navigation=self.webpackChunkheyanai_navigation||[]).push([[757],{78844:function(se,F,e){var d=e(1413),p=e(91),_=e(86190),s=e(67294),I=e(66758),u=e(97556),U=e(85893),h=["fieldProps","proFieldProps"],m="dateTimeRange",G=s.forwardRef(function(b,T){var A=b.fieldProps,Z=b.proFieldProps,r=(0,p.Z)(b,h),B=(0,s.useContext)(I.Z);return(0,U.jsx)(u.Z,(0,d.Z)({ref:T,fieldProps:(0,d.Z)({getPopupContainer:B.getPopupContainer},A),valueType:m,proFieldProps:Z,filedConfig:{valueType:m,customLightMode:!0,lightFilterLabelFormatter:function(w){return(0,_.c)(w,"YYYY-MM-DD HH:mm:ss")}}},r))});F.Z=G},64317:function(se,F,e){var d=e(1413),p=e(91),_=e(22270),s=e(67294),I=e(66758),u=e(97556),U=e(85893),h=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],m=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],G=s.forwardRef(function(r,B){var g=r.fieldProps,w=r.children,z=r.params,q=r.proFieldProps,K=r.mode,k=r.valueEnum,c=r.request,H=r.showSearch,V=r.options,ee=(0,p.Z)(r,h),R=(0,s.useContext)(I.Z);return(0,U.jsx)(u.Z,(0,d.Z)((0,d.Z)({valueEnum:(0,_.h)(k),request:c,params:z,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,d.Z)({options:V,mode:K,showSearch:H,getPopupContainer:R.getPopupContainer},g),ref:B,proFieldProps:q},ee),{},{children:w}))}),b=s.forwardRef(function(r,B){var g=r.fieldProps,w=r.children,z=r.params,q=r.proFieldProps,K=r.mode,k=r.valueEnum,c=r.request,H=r.options,V=(0,p.Z)(r,m),ee=(0,d.Z)({options:H,mode:K||"multiple",labelInValue:!0,showSearch:!0,showArrow:!1,autoClearSearchValue:!0,optionLabelProp:"label"},g),R=(0,s.useContext)(I.Z);return(0,U.jsx)(u.Z,(0,d.Z)((0,d.Z)({valueEnum:(0,_.h)(k),request:c,params:z,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,d.Z)({getPopupContainer:R.getPopupContainer},ee),ref:B,proFieldProps:q},V),{},{children:w}))}),T=G,A=b,Z=T;Z.SearchSelect=A,Z.displayName="ProFormComponent",F.Z=Z},34994:function(se,F,e){e.d(F,{A:function(){return R}});var d=e(1413),p=e(12029),_=e(67294),s=e(78733),I=e(4942),u=e(97685),U=e(87462),h=e(50756),m=e(46976),G=function(P,M){return _.createElement(m.Z,(0,U.Z)({},P,{ref:M,icon:h.Z}))},b=_.forwardRef(G),T=e(21770),A=e(48874),Z=e(17093),r=e(42075),B=e(94184),g=e.n(B),w=e(66758),z=e(2514),q=e(98082),K=function(P){var M;return(0,I.Z)({},P.componentCls,{"&-title":{marginBlockEnd:P.marginXL,fontWeight:"bold"},"&-container":(0,I.Z)({flexWrap:"wrap",maxWidth:"100%"},"> div".concat(P.antCls,"-space-item"),{maxWidth:"100%"}),"&-twoLine":(M={display:"block",width:"100%"},(0,I.Z)(M,"".concat(P.componentCls,"-title"),{width:"100%",margin:"8px 0"}),(0,I.Z)(M,"".concat(P.componentCls,"-container"),{paddingInlineStart:16}),(0,I.Z)(M,"".concat(P.antCls,"-space-item,").concat(P.antCls,"-form-item"),{width:"100%"}),(0,I.Z)(M,"".concat(P.antCls,"-form-item"),{"&-control":{display:"flex",alignItems:"center",justifyContent:"flex-end","&-input":{alignItems:"center",justifyContent:"flex-end","&-content":{flex:"none"}}}}),M)})};function k(L){return(0,q.Xj)("ProFormGroup",function(P){var M=(0,d.Z)((0,d.Z)({},P),{},{componentCls:".".concat(L)});return[K(M)]})}var c=e(85893),H=_.forwardRef(function(L,P){var M=_.useContext(w.Z),N=M.groupProps,i=(0,d.Z)((0,d.Z)({},N),L),W=i.children,Y=i.collapsible,$=i.defaultCollapsed,S=i.style,X=i.labelLayout,o=i.title,n=o===void 0?L.label:o,l=i.tooltip,v=i.align,t=v===void 0?"start":v,x=i.direction,y=i.size,f=y===void 0?32:y,j=i.titleStyle,D=i.titleRender,a=i.spaceProps,E=i.extra,C=i.autoFocus,O=(0,T.Z)(function(){return $||!1},{value:L.collapsed,onChange:L.onCollapse}),Q=(0,u.Z)(O,2),J=Q[0],ne=Q[1],re=(0,_.useContext)(Z.ZP.ConfigContext),ie=re.getPrefixCls,le=(0,z.zx)(L),ce=le.ColWrapper,me=le.RowWrapper,oe=ie("pro-form-group"),ve=k(oe),ye=ve.wrapSSR,de=ve.hashId,he=Y&&(0,c.jsx)(b,{style:{marginInlineEnd:8},rotate:J?void 0:90}),fe=(0,c.jsx)(A.G,{label:he?(0,c.jsxs)("div",{children:[he,n]}):n,tooltip:l}),_e=(0,_.useCallback)(function(ae){var ue=ae.children;return(0,c.jsx)(r.Z,(0,d.Z)((0,d.Z)({},a),{},{className:g()("".concat(oe,"-container ").concat(de),a==null?void 0:a.className),size:f,align:t,direction:x,style:(0,d.Z)({rowGap:0},a==null?void 0:a.style),children:ue}))},[t,oe,x,de,f,a]),ge=D?D(fe,L):fe,Ee=(0,_.useMemo)(function(){var ae=[],ue=_.Children.toArray(W).map(function(te,xe){var pe;return _.isValidElement(te)&&te!==null&&te!==void 0&&(pe=te.props)!==null&&pe!==void 0&&pe.hidden?(ae.push(te),null):xe===0&&_.isValidElement(te)&&C?_.cloneElement(te,(0,d.Z)((0,d.Z)({},te.props),{},{autoFocus:C})):te});return[(0,c.jsx)(me,{Wrapper:_e,children:ue},"children"),ae.length>0?(0,c.jsx)("div",{style:{display:"none"},children:ae}):null]},[W,me,_e,C]),Pe=(0,u.Z)(Ee,2),Ce=Pe[0],Me=Pe[1];return ye((0,c.jsx)(ce,{children:(0,c.jsxs)("div",{className:g()(oe,de,(0,I.Z)({},"".concat(oe,"-twoLine"),X==="twoLine")),style:S,ref:P,children:[Me,(n||l||E)&&(0,c.jsx)("div",{className:"".concat(oe,"-title ").concat(de).trim(),style:j,onClick:function(){ne(!J)},children:E?(0,c.jsxs)("div",{style:{display:"flex",width:"100%",alignItems:"center",justifyContent:"space-between"},children:[ge,(0,c.jsx)("span",{onClick:function(ue){return ue.stopPropagation()},children:E})]}):ge}),(0,c.jsx)("div",{style:{display:Y&&J?"none":void 0},children:Ce})]})}))});H.displayName="ProForm-Group";var V=H,ee=e(4499);function R(L){return(0,c.jsx)(s.I,(0,d.Z)({layout:"vertical",submitter:{render:function(M,N){return N.reverse()}},contentRender:function(M,N){return(0,c.jsxs)(c.Fragment,{children:[M,N]})}},L))}R.Group=V,R.useForm=p.Z.useForm,R.Item=ee.Z,R.useWatch=p.Z.useWatch,R.ErrorList=p.Z.ErrorList,R.Provider=p.Z.Provider,R.useFormInstance=p.Z.useFormInstance},23809:function(se,F,e){e.d(F,{$:function(){return U}});var d=e(97857),p=e.n(d),_=e(64317),s=e(80854),I=e(67294),u=e(85893);function U(h){var m,G=(0,s.useIntl)(),b=(0,s.useModel)("mapModel"),T=b.run,A=b.options,Z=b.loading,r=b.initialValue;return I.useEffect(function(){T()},[]),(0,u.jsx)(_.Z,p()(p()({},h),{},{rules:[{required:!0,message:G.formatMessage({id:"pages.device-manage.track.map.required",defaultMessage:"\u8BF7\u9009\u62E9\u5730\u56FE"})}],width:"lg",name:"mapId",style:{width:240},fieldProps:{loading:Z},initialValue:(m=h.initialValue)!==null&&m!==void 0?m:r,options:A}))}},38943:function(se,F,e){e.r(F),e.d(F,{default:function(){return N}});var d=e(5574),p=e.n(d),_=e(97857),s=e.n(_),I=e(19632),u=e.n(I),U=e(87888),h=e(32240),m=e(45968),G=e(30692),b=e(92138),T=e(63060),A=e(4393),Z=e(96486),r=e(67294),B=e(67058),g=e(85893),w={Equipment:b.Q6,Personnel:b.ek,Vehicle:b.EV,Stuff:b.iN};function z(i){var W,Y=p()(i.rect,2),$=Y[0],S=Y[1],X=r.useState(),o=p()(X,2),n=o[0],l=o[1],v=r.useRef(null),t=r.useRef(),x=r.useRef(),y=r.useRef(),f=r.useRef({});return r.useEffect(function(){var j;t.current=new T.Scene({id:v.current,logoVisible:!1,map:new T.Mapbox({style:"blank",center:[0,0],pitch:0,zoom:20,minZoom:18})}),t.current.addImage("stationIcon",m.Z),t.current.addImage("arrow",U.Z),t.current.addImage("personImage",h.Z),t.current.addImage("warning",G.Z),(j=t.current)===null||j===void 0||j.on("loaded",function(){return l(!0)})},[]),r.useEffect(function(){if(i.map&&n&&S&&$){var j=(0,T.metersToLngLat)([$*B.bA,S*B.bA]);if(x.current)x.current.setData(i.map,{parser:{type:"image",extent:[0,0].concat(u()(j))}}),x.current.setIndex(0);else{var D,a;x.current=new T.ImageLayer({zIndex:0}),x.current.source(i.map,{parser:{type:"image",extent:[0,0].concat(u()(j))}}),(D=t.current)===null||D===void 0||D.setCenter([j[0]/2,j[1]/2]),(a=t.current)===null||a===void 0||a.addLayer(x.current)}}},[i.map,n,S,$]),r.useEffect(function(){if(n&&S&&!(0,Z.isEmpty)(i.stations)){var j,D,a=(j=(D=i.stations)!==null&&D!==void 0?D:[])===null||j===void 0?void 0:j.map(function(C){var O=(0,B.qS)([C.setX,C.setY],S),Q=p()(O,2),J=Q[0],ne=Q[1];return s()(s()({},C),{},{lng:J,lat:ne})});if(y.current)y.current.setData(a),y.current.setIndex(3);else{var E;y.current=new T.PointLayer({zIndex:3}).source(a,{parser:{type:"json",x:"lng",y:"lat",name:"name"}}).shape("name",["stationIcon"]).size(10),(E=t.current)===null||E===void 0||E.addLayer(y.current)}}},[i.stations,n,S]),r.useEffect(function(){if(n&&S){var j,D=(0,Z.chain)((j=i.beacons)!==null&&j!==void 0?j:[]).groupBy(function(a){return a.type}).mapValues(function(a){return(0,Z.chain)(a).countBy(function(E){var C,O;return"".concat((C=E.posX)===null||C===void 0?void 0:C.toFixed(1),"-").concat((O=E.posY)===null||O===void 0?void 0:O.toFixed(1))}).map(function(E,C){var O=C.split("-").map(Number),Q=p()(O,2),J=Q[0],ne=Q[1],re=(0,B.qS)([J,ne],S),ie=p()(re,2),le=ie[0],ce=ie[1];return{lng:le,lat:ce,sum:E}}).value()}).value();(0,Z.forEach)(["Equipment","Personnel","Vehicle","Stuff"],function(a){var E;if((E=f.current)!==null&&E!==void 0&&E[a]){var O;f.current[a].setData(D[a]),(O=f.current[a])===null||O===void 0||O.show(),f.current[a].setIndex(4)}else{var C;f.current[a]=new T.HeatmapLayer({name:"heat-map-Equipment-layer"}).source(D[a],{parser:{type:"json",x:"lng",y:"lat"}}).shape("heatmap").size("sum",[0,1]).style({intensity:2,radius:20,rampColors:{colors:[w[a][2],w[a][3],w[a][4],w[a][5],w[a][7],w[a][9]].reverse(),positions:[0,.2,.4,.6,.8,1]}}),(C=t.current)===null||C===void 0||C.addLayer(f.current[a])}})}},[i.beacons,n,S]),(0,g.jsx)(r.Fragment,{children:(0,g.jsx)(A.Z,{bodyStyle:{padding:0},children:(0,g.jsx)("div",{id:"map",ref:v,style:{minHeight:(W=i.height)!==null&&W!==void 0?W:600}})})})}var q=e(23809),K=e(84140),k=e(491),c=e(69851),H=e(90930),V=e(28199),ee=e(34994),R=e(78844),L=e(80854),P=e(27484),M=e.n(P);function N(){var i,W,Y,$=(0,L.useIntl)(),S=r.useRef(),X=(0,L.useRequest)(k.FU,{manual:!0,formatResult:function(a){return a}}),o=X.run,n=X.data,l=(0,L.useRequest)(K.uz,{manual:!0}),v=l.run,t=l.data,x=(0,L.useRequest)(K.s_,{manual:!0,formatResult:function(a){return a}}),y=x.run,f=x.data;function j(D){var a=D.mapId;return o({mapId:a}).then(function(){return v({mapId:a})}).then(function(){return y(D)}).then(function(E){return E.code===c.OK})}return(0,g.jsxs)(H._z,{childrenContentStyle:{padding:20},children:[(0,g.jsx)(V.Z,{children:(0,g.jsxs)(ee.A,{submitter:{resetButtonProps:{style:{display:"none"}}},formRef:S,layout:"inline",style:{minWidth:320},onFinish:function(a){return j(a)},children:[(0,g.jsx)(q.$,{}),(0,g.jsx)(R.Z,{name:"range",transform:function(a){var E,C,O,Q=(E=(0,c.G$)(a))!==null&&E!==void 0?E:[],J=p()(Q,2),ne=J[0],re=J[1];return{startTime:ne?(C=M()(ne))===null||C===void 0?void 0:C.unix():void 0,endTime:re?(O=M()(re))===null||O===void 0?void 0:O.unix():void 0}},placeholder:[$.formatMessage({id:"pages.position-manage.tracking-manage.start.time",defaultMessage:"\u8BF7\u9009\u62E9\u8D77\u59CB\u65F6\u95F4"}),$.formatMessage({id:"pages.position-manage.tracking-manage.end.time",defaultMessage:"\u8BF7\u9009\u62E9\u7ED3\u675F\u65F6\u95F4"})]})]})}),(0,g.jsx)(A.Z,{style:{marginTop:12},children:(0,g.jsx)(z,{map:n==null||(i=n.data)===null||i===void 0?void 0:i.picture,rect:[n==null||(W=n.data)===null||W===void 0?void 0:W.length,n==null||(Y=n.data)===null||Y===void 0?void 0:Y.width],stations:t==null?void 0:t.items,beacons:f==null?void 0:f.data})})]})}},84140:function(se,F,e){e.d(F,{$h:function(){return Z},Ig:function(){return w},TB:function(){return S},Um:function(){return i},WN:function(){return L},Zc:function(){return q},_s:function(){return H},aL:function(){return Y},bD:function(){return ee},s_:function(){return M},uz:function(){return k},x2:function(){return B}});var d=e(13769),p=e.n(d),_=e(15009),s=e.n(_),I=e(97857),u=e.n(I),U=e(99289),h=e.n(U),m=e(80854),G=["deviceId"],b=["deviceId"],T=["gateway"],A=["gateway"];function Z(o,n){return r.apply(this,arguments)}function r(){return r=h()(s()().mark(function o(n,l){return s()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,m.request)("/api/v1/beacon",u()({method:"GET",params:u()({current:"1",size:"10"},n)},l||{})));case 1:case"end":return t.stop()}},o)})),r.apply(this,arguments)}function B(o,n){return g.apply(this,arguments)}function g(){return g=h()(s()().mark(function o(n,l){return s()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,m.request)("/api/v1/beacon",u()({method:"POST",headers:{"Content-Type":"application/json"},data:n},l||{})));case 1:case"end":return t.stop()}},o)})),g.apply(this,arguments)}function w(o,n,l){return z.apply(this,arguments)}function z(){return z=h()(s()().mark(function o(n,l,v){var t,x;return s()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return t=n.deviceId,x=p()(n,G),f.abrupt("return",(0,m.request)("/api/v1/beacon/".concat(t),u()({method:"PUT",headers:{"Content-Type":"application/json"},params:u()({},x),data:l},v||{})));case 2:case"end":return f.stop()}},o)})),z.apply(this,arguments)}function q(o,n){return K.apply(this,arguments)}function K(){return K=h()(s()().mark(function o(n,l){var v,t;return s()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return v=n.deviceId,t=p()(n,b),y.abrupt("return",(0,m.request)("/api/v1/beacon/".concat(v),u()({method:"DELETE",params:u()({},t)},l||{})));case 2:case"end":return y.stop()}},o)})),K.apply(this,arguments)}function k(o,n){return c.apply(this,arguments)}function c(){return c=h()(s()().mark(function o(n,l){return s()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,m.request)("/api/v1/gateway",u()({method:"GET",params:u()({current:"1",size:"10"},n)},l||{})));case 1:case"end":return t.stop()}},o)})),c.apply(this,arguments)}function H(o,n){return V.apply(this,arguments)}function V(){return V=h()(s()().mark(function o(n,l){return s()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,m.request)("/api/v1/gateway",u()({method:"POST",headers:{"Content-Type":"application/json"},data:n},l||{})));case 1:case"end":return t.stop()}},o)})),V.apply(this,arguments)}function ee(o,n){return R.apply(this,arguments)}function R(){return R=h()(s()().mark(function o(n,l){var v,t;return s()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return v=n.gateway,t=p()(n,T),y.abrupt("return",(0,m.request)("/api/v1/gateway/".concat(v),u()({method:"DELETE",params:u()({},t)},l||{})));case 2:case"end":return y.stop()}},o)})),R.apply(this,arguments)}function L(o,n,l){return P.apply(this,arguments)}function P(){return P=h()(s()().mark(function o(n,l,v){var t,x;return s()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return t=n.gateway,x=p()(n,A),f.abrupt("return",(0,m.request)("/api/v1/gateway".concat(t),u()({method:"PUT",headers:{"Content-Type":"application/json"},params:u()({},x),data:l},v||{})));case 2:case"end":return f.stop()}},o)})),P.apply(this,arguments)}function M(o,n){return N.apply(this,arguments)}function N(){return N=h()(s()().mark(function o(n,l){return s()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,m.request)("/api/v1/location",u()({method:"GET",params:u()({},n)},l||{})));case 1:case"end":return t.stop()}},o)})),N.apply(this,arguments)}function i(o,n){return W.apply(this,arguments)}function W(){return W=h()(s()().mark(function o(n,l){return s()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,m.request)("/api/v1/status/beacon",u()({method:"GET",params:u()({},n)},l||{})));case 1:case"end":return t.stop()}},o)})),W.apply(this,arguments)}function Y(o,n){return $.apply(this,arguments)}function $(){return $=h()(s()().mark(function o(n,l){return s()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,m.request)("/api/v1/status/gateway",u()({method:"GET",params:u()({},n)},l||{})));case 1:case"end":return t.stop()}},o)})),$.apply(this,arguments)}function S(o,n){return X.apply(this,arguments)}function X(){return X=h()(s()().mark(function o(n,l){return s()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,m.request)("/api/v1/unbound/beacon",u()({method:"GET",params:u()({},n)},l||{})));case 1:case"end":return t.stop()}},o)})),X.apply(this,arguments)}}}]);
