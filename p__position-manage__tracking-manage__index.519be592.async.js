"use strict";(self.webpackChunkheyanai_navigation=self.webpackChunkheyanai_navigation||[]).push([[478],{78844:function(ee,W,e){var g=e(1413),_=e(91),A=e(86190),r=e(67294),S=e(66758),u=e(86682),b=e(85893),m=["fieldProps","proFieldProps"],i="dateTimeRange",U=r.forwardRef(function(E,M){var K=E.fieldProps,D=E.proFieldProps,t=(0,_.Z)(E,m),P=(0,r.useContext)(S.Z);return(0,b.jsx)(u.Z,(0,g.Z)({ref:M,fieldProps:(0,g.Z)({getPopupContainer:P.getPopupContainer},K),valueType:i,proFieldProps:D,filedConfig:{valueType:i,customLightMode:!0,lightFilterLabelFormatter:function(B){return(0,A.c)(B,"YYYY-MM-DD HH:mm:ss")}}},t))});W.Z=U},64317:function(ee,W,e){var g=e(1413),_=e(91),A=e(22270),r=e(67294),S=e(66758),u=e(86682),b=e(85893),m=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],i=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],U=r.forwardRef(function(t,P){var l=t.fieldProps,B=t.children,T=t.params,C=t.proFieldProps,y=t.mode,Z=t.valueEnum,O=t.request,$=t.showSearch,z=t.options,R=(0,_.Z)(t,m),x=(0,r.useContext)(S.Z);return(0,b.jsx)(u.Z,(0,g.Z)((0,g.Z)({valueEnum:(0,A.h)(Z),request:O,params:T,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,g.Z)({options:z,mode:y,showSearch:$,getPopupContainer:x.getPopupContainer},l),ref:P,proFieldProps:C},R),{},{children:B}))}),E=r.forwardRef(function(t,P){var l=t.fieldProps,B=t.children,T=t.params,C=t.proFieldProps,y=t.mode,Z=t.valueEnum,O=t.request,$=t.options,z=(0,_.Z)(t,i),R=(0,g.Z)({options:$,mode:y||"multiple",labelInValue:!0,showSearch:!0,showArrow:!1,autoClearSearchValue:!0,optionLabelProp:"label"},l),x=(0,r.useContext)(S.Z);return(0,b.jsx)(u.Z,(0,g.Z)((0,g.Z)({valueEnum:(0,A.h)(Z),request:O,params:T,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,g.Z)({getPopupContainer:x.getPopupContainer},R),ref:P,proFieldProps:C},z),{},{children:B}))}),M=U,K=E,D=M;D.SearchSelect=K,D.displayName="ProFormComponent",W.Z=D},23809:function(ee,W,e){e.d(W,{$:function(){return b}});var g=e(97857),_=e.n(g),A=e(64317),r=e(35312),S=e(67294),u=e(85893);function b(m){var i,U=(0,r.useIntl)(),E=(0,r.useModel)("mapModel"),M=E.run,K=E.options,D=E.loading,t=E.initialValue;return S.useEffect(function(){M()},[]),(0,u.jsx)(A.Z,_()(_()({},m),{},{rules:[{required:!0,message:U.formatMessage({id:"pages.device-manage.track.map.required",defaultMessage:"\u8BF7\u9009\u62E9\u5730\u56FE"})}],width:"lg",name:"mapId",style:{width:240},fieldProps:{loading:D},initialValue:(i=m.initialValue)!==null&&i!==void 0?i:t,options:K}))}},75888:function(ee,W,e){e.d(W,{Z:function(){return M},l:function(){return K}});var g=e(15009),_=e.n(g),A=e(99289),r=e.n(A),S=e(97857),u=e.n(S),b=e(84140),m=e(69851),i=e(64317),U=e(35312),E=e(85893);function M(D){var t=(0,U.useIntl)(),P=(0,U.useRequest)(b.TB,{manual:!0,formatResult:function(T){var C,y,Z=(C=(y=T.data)===null||y===void 0?void 0:y.map(function(O){return{label:O.deviceId,value:O.deviceId,key:O.deviceId}}))!==null&&C!==void 0?C:[];return Z}}),l=P.run;return(0,E.jsx)(i.Z,u()({label:t.formatMessage({id:"pages.personnel-manage.organization.department.person.tag",defaultMessage:"\u7ED1\u5B9A\u6807\u7B7E"}),request:function(){return l({})}},D))}function K(D){var t=(0,U.useIntl)();return(0,E.jsx)(i.Z,u()({request:function(){var P=r()(_()().mark(function l(B){var T,C,y,Z,O,$;return _()().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return y=B.keyWords,Z=y===void 0?"":y,R.next=3,(0,b.$h)({current:"1",size:"20",name:Z});case 3:return O=R.sent,$=(T=(C=(0,m.LF)(O).data)===null||C===void 0?void 0:C.map(function(x){return{label:x.name,value:x.deviceId,key:x.deviceId}}))!==null&&T!==void 0?T:[],R.abrupt("return",$);case 6:case"end":return R.stop()}},l)}));return function(l){return P.apply(this,arguments)}}(),placeholder:t.formatMessage({id:"pages.personnel-manage.organization.department.person.tag.placeholder",defaultMessage:"\u8BF7\u9009\u62E9\u6807\u7B7E"}),rules:[{required:!0,message:t.formatMessage({id:"pages.device-manage.track.beacon.required",defaultMessage:"\u8BF7\u9009\u62E9\u6807\u7B7E"})}],fieldProps:{showSearch:!0,style:{minWidth:180}}},D))}},76403:function(ee,W,e){e.r(W),e.d(W,{default:function(){return ne}});var g=e(5574),_=e.n(g),A=e(97857),r=e.n(A),S=e(19632),u=e.n(S),b=e(87888),m=e(32240),i=e(45968),U=e(30692),E=e(92138),M=e(62466),K=e(4393),D=e(96486),t=e(67294),P=e(67058),l=e(85893);function B(f){var w,H=_()(f.rect,2),V=H[0],I=H[1],N=t.useState(),s=_()(N,2),n=s[0],o=s[1],p=t.useRef(null),a=t.useRef(),j=t.useRef(),h=t.useRef(),v=t.useRef(),Y=t.useRef();return t.useEffect(function(){var c;a.current=new M.Scene({id:p.current,logoVisible:!1,map:new M.Mapbox({style:"blank",center:[0,0],pitch:0,zoom:20,minZoom:18})}),a.current.addImage("stationIcon",i.Z),a.current.addImage("arrow",b.Z),a.current.addImage("personImage",m.Z),a.current.addImage("warning",U.Z),(c=a.current)===null||c===void 0||c.on("loaded",function(){return o(!0)})},[]),t.useEffect(function(){if(f.map&&n&&I&&V){var c=(0,M.metersToLngLat)([V*P.bA,I*P.bA]);if(j.current)j.current.setData(f.map,{parser:{type:"image",extent:[0,0].concat(u()(c))}}),j.current.setIndex(0);else{var d,L;j.current=new M.ImageLayer({zIndex:0}),j.current.source(f.map,{parser:{type:"image",extent:[0,0].concat(u()(c))}}),(d=a.current)===null||d===void 0||d.setCenter([c[0]/2,c[1]/2]),(L=a.current)===null||L===void 0||L.addLayer(j.current)}}},[f.map,n,I,V]),t.useEffect(function(){if(n&&I&&!(0,D.isEmpty)(f.stations)){var c,d,L=(c=(d=f.stations)!==null&&d!==void 0?d:[])===null||c===void 0?void 0:c.map(function(F){var Q=(0,P.qS)([F.setX,F.setY],I),X=_()(Q,2),k=X[0],J=X[1];return r()(r()({},F),{},{lng:k,lat:J})});if(h.current)h.current.setData(L),h.current.setIndex(3);else{var G;h.current=new M.PointLayer({zIndex:3}).source(L,{parser:{type:"json",x:"lng",y:"lat",name:"name"}}).shape("name",["stationIcon"]).size(10),(G=a.current)===null||G===void 0||G.addLayer(h.current)}}},[f.stations,n,I]),t.useEffect(function(){if(n&&I){for(var c,d=(c=f.beacons)!==null&&c!==void 0?c:[],L=d==null?void 0:d.map(function(ue){var pe=(0,P.qS)([ue.posX,ue.posY],I),ie=_()(pe,2),ve=ie[0],fe=ie[1];return r()(r()({},ue),{},{lng:ve,lat:fe})}),G=[],F=0;F<d.length;F++){var Q=d[F],X=d[F+1];if(X){var k=(0,P.qS)([Q.posX,Q.posY],I),J=_()(k,2),le=J[0],de=J[1],_e=(0,P.qS)([X.posX,X.posY],I),oe=_()(_e,2),me=oe[0],ce=oe[1];G.push(r()(r()({},Q),{},{lng:le,lat:de,lng1:me,lat1:ce}))}}if(v.current)(0,D.isEmpty)(f.beacons)?v.current.hide():(v.current.show(),v.current.setData(G),v.current.setIndex(3));else{var re;v.current=new M.LineLayer({zIndex:3}).source(G,{parser:{type:"json",x:"lng",y:"lat",x1:"lng1",y1:"lat1"}}).shape("line").size(2).color(E.ek[3]).animate({interval:.4,duration:1,trailLength:.8}).style({lineTexture:!0,iconStep:20}),(re=a.current)===null||re===void 0||re.addLayer(v.current)}if(Y.current)(0,D.isEmpty)(f.beacons)?Y.current.hide():(Y.current.show(),Y.current.setData(L),Y.current.setIndex(4));else{var se;Y.current=new M.PointLayer({zIndex:4}).source(L,{parser:{type:"json",x:"lng",y:"lat",name:"name"}}).shape("circle").color(E.ek[3]).size(5),(se=a.current)===null||se===void 0||se.addLayer(Y.current)}}},[f.beacons,n,I]),(0,l.jsx)(t.Fragment,{children:(0,l.jsx)(K.Z,{bodyStyle:{padding:0},children:(0,l.jsx)("div",{id:"map",ref:p,style:{minHeight:(w=f.height)!==null&&w!==void 0?w:600}})})})}var T=e(23809),C=e(75888),y=e(84140),Z=e(491),O=e(69851),$=e(90930),z=e(28199),R=e(57470),x=e(78844),q=e(35312),ae=e(27484),te=e.n(ae);function ne(){var f,w,H,V=(0,q.useIntl)(),I=t.useRef(),N=(0,q.useRequest)(Z.FU,{manual:!0,formatResult:function(d){return d}}),s=N.run,n=N.data,o=(0,q.useRequest)(y.uz,{manual:!0}),p=o.run,a=o.data,j=(0,q.useRequest)(y.s_,{manual:!0,formatResult:function(d){return d}}),h=j.run,v=j.data;function Y(c){var d=c.mapId;return s({mapId:d}).then(function(){return p({mapId:d})}).then(function(){return h(c)}).then(function(L){return L.code===O.OK})}return(0,l.jsxs)($._z,{childrenContentStyle:{padding:20},children:[(0,l.jsx)(z.Z,{children:(0,l.jsxs)(R.t,{submitter:{resetButtonProps:{style:{display:"none"}}},formRef:I,layout:"vertical",span:6,onFinish:function(d){return Y(d)},children:[(0,l.jsx)(T.$,{}),(0,l.jsx)(C.l,{name:"deviceId"}),(0,l.jsx)(x.Z,{name:"range",transform:function(d){var L,G,F,Q=(L=(0,O.G$)(d))!==null&&L!==void 0?L:[],X=_()(Q,2),k=X[0],J=X[1];return{startTime:k?(G=te()(k))===null||G===void 0?void 0:G.unix():void 0,endTime:J?(F=te()(J))===null||F===void 0?void 0:F.unix():void 0}},placeholder:[V.formatMessage({id:"pages.position-manage.tracking-manage.start.time",defaultMessage:"\u8BF7\u9009\u62E9\u8D77\u59CB\u65F6\u95F4"}),V.formatMessage({id:"pages.position-manage.tracking-manage.end.time",defaultMessage:"\u8BF7\u9009\u62E9\u7ED3\u675F\u65F6\u95F4"})]})]})}),(0,l.jsx)(K.Z,{style:{marginTop:12},children:(0,l.jsx)(B,{map:n==null||(f=n.data)===null||f===void 0?void 0:f.picture,rect:[n==null||(w=n.data)===null||w===void 0?void 0:w.length,n==null||(H=n.data)===null||H===void 0?void 0:H.width],stations:a==null?void 0:a.items,beacons:v==null?void 0:v.data})})]})}},84140:function(ee,W,e){e.d(W,{$h:function(){return D},Ig:function(){return B},TB:function(){return I},Um:function(){return f},WN:function(){return q},Zc:function(){return C},_s:function(){return $},aL:function(){return H},bD:function(){return R},s_:function(){return te},uz:function(){return Z},x2:function(){return P}});var g=e(13769),_=e.n(g),A=e(15009),r=e.n(A),S=e(97857),u=e.n(S),b=e(99289),m=e.n(b),i=e(35312),U=["deviceId"],E=["deviceId"],M=["gateway"],K=["gateway"];function D(s,n){return t.apply(this,arguments)}function t(){return t=m()(r()().mark(function s(n,o){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,i.request)("/api/v1/beacon",u()({method:"GET",params:u()({current:"1",size:"10"},n)},o||{})));case 1:case"end":return a.stop()}},s)})),t.apply(this,arguments)}function P(s,n){return l.apply(this,arguments)}function l(){return l=m()(r()().mark(function s(n,o){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,i.request)("/api/v1/beacon",u()({method:"POST",headers:{"Content-Type":"application/json"},data:n},o||{})));case 1:case"end":return a.stop()}},s)})),l.apply(this,arguments)}function B(s,n,o){return T.apply(this,arguments)}function T(){return T=m()(r()().mark(function s(n,o,p){var a,j;return r()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return a=n.deviceId,j=_()(n,U),v.abrupt("return",(0,i.request)("/api/v1/beacon/".concat(a),u()({method:"PUT",headers:{"Content-Type":"application/json"},params:u()({},j),data:o},p||{})));case 2:case"end":return v.stop()}},s)})),T.apply(this,arguments)}function C(s,n){return y.apply(this,arguments)}function y(){return y=m()(r()().mark(function s(n,o){var p,a;return r()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return p=n.deviceId,a=_()(n,E),h.abrupt("return",(0,i.request)("/api/v1/beacon/".concat(p),u()({method:"DELETE",params:u()({},a)},o||{})));case 2:case"end":return h.stop()}},s)})),y.apply(this,arguments)}function Z(s,n){return O.apply(this,arguments)}function O(){return O=m()(r()().mark(function s(n,o){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,i.request)("/api/v1/gateway",u()({method:"GET",params:u()({current:"1",size:"10"},n)},o||{})));case 1:case"end":return a.stop()}},s)})),O.apply(this,arguments)}function $(s,n){return z.apply(this,arguments)}function z(){return z=m()(r()().mark(function s(n,o){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,i.request)("/api/v1/gateway",u()({method:"POST",headers:{"Content-Type":"application/json"},data:n},o||{})));case 1:case"end":return a.stop()}},s)})),z.apply(this,arguments)}function R(s,n){return x.apply(this,arguments)}function x(){return x=m()(r()().mark(function s(n,o){var p,a;return r()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return p=n.gateway,a=_()(n,M),h.abrupt("return",(0,i.request)("/api/v1/gateway/".concat(p),u()({method:"DELETE",params:u()({},a)},o||{})));case 2:case"end":return h.stop()}},s)})),x.apply(this,arguments)}function q(s,n,o){return ae.apply(this,arguments)}function ae(){return ae=m()(r()().mark(function s(n,o,p){var a,j;return r()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return a=n.gateway,j=_()(n,K),v.abrupt("return",(0,i.request)("/api/v1/gateway".concat(a),u()({method:"PUT",headers:{"Content-Type":"application/json"},params:u()({},j),data:o},p||{})));case 2:case"end":return v.stop()}},s)})),ae.apply(this,arguments)}function te(s,n){return ne.apply(this,arguments)}function ne(){return ne=m()(r()().mark(function s(n,o){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,i.request)("/api/v1/location",u()({method:"GET",params:u()({},n)},o||{})));case 1:case"end":return a.stop()}},s)})),ne.apply(this,arguments)}function f(s,n){return w.apply(this,arguments)}function w(){return w=m()(r()().mark(function s(n,o){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,i.request)("/api/v1/status/beacon",u()({method:"GET",params:u()({},n)},o||{})));case 1:case"end":return a.stop()}},s)})),w.apply(this,arguments)}function H(s,n){return V.apply(this,arguments)}function V(){return V=m()(r()().mark(function s(n,o){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,i.request)("/api/v1/status/gateway",u()({method:"GET",params:u()({},n)},o||{})));case 1:case"end":return a.stop()}},s)})),V.apply(this,arguments)}function I(s,n){return N.apply(this,arguments)}function N(){return N=m()(r()().mark(function s(n,o){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,i.request)("/api/v1/unbound/beacon",u()({method:"GET",params:u()({},n)},o||{})));case 1:case"end":return a.stop()}},s)})),N.apply(this,arguments)}}}]);
