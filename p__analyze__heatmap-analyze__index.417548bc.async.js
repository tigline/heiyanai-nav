"use strict";(self.webpackChunkheyanai_navigation=self.webpackChunkheyanai_navigation||[]).push([[757],{78844:function(se,K,e){var l=e(1413),c=e(91),g=e(86190),o=e(67294),O=e(66758),i=e(86682),$=e(85893),v=["fieldProps","proFieldProps"],p="dateTimeRange",V=o.forwardRef(function(I,Z){var w=I.fieldProps,S=I.proFieldProps,r=(0,c.Z)(I,v),W=(0,o.useContext)(O.Z);return(0,$.jsx)(i.Z,(0,l.Z)({ref:Z,fieldProps:(0,l.Z)({getPopupContainer:W.getPopupContainer},w),valueType:p,proFieldProps:S,filedConfig:{valueType:p,customLightMode:!0,lightFilterLabelFormatter:function(B){return(0,g.c)(B,"YYYY-MM-DD HH:mm:ss")}}},r))});K.Z=V},64317:function(se,K,e){var l=e(1413),c=e(91),g=e(22270),o=e(67294),O=e(66758),i=e(86682),$=e(85893),v=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],p=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],V=o.forwardRef(function(r,W){var C=r.fieldProps,B=r.children,N=r.params,q=r.proFieldProps,G=r.mode,f=r.valueEnum,A=r.request,k=r.showSearch,Y=r.options,b=(0,c.Z)(r,v),y=(0,o.useContext)(O.Z);return(0,$.jsx)(i.Z,(0,l.Z)((0,l.Z)({valueEnum:(0,g.h)(f),request:A,params:N,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,l.Z)({options:Y,mode:G,showSearch:k,getPopupContainer:y.getPopupContainer},C),ref:W,proFieldProps:q},b),{},{children:B}))}),I=o.forwardRef(function(r,W){var C=r.fieldProps,B=r.children,N=r.params,q=r.proFieldProps,G=r.mode,f=r.valueEnum,A=r.request,k=r.options,Y=(0,c.Z)(r,p),b=(0,l.Z)({options:k,mode:G||"multiple",labelInValue:!0,showSearch:!0,showArrow:!1,autoClearSearchValue:!0,optionLabelProp:"label"},C),y=(0,o.useContext)(O.Z);return(0,$.jsx)(i.Z,(0,l.Z)((0,l.Z)({valueEnum:(0,g.h)(f),request:A,params:N,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,l.Z)({getPopupContainer:y.getPopupContainer},b),ref:W,proFieldProps:q},Y),{},{children:B}))}),Z=V,w=I,S=Z;S.SearchSelect=w,S.displayName="ProFormComponent",K.Z=S},34994:function(se,K,e){e.d(K,{A:function(){return b}});var l=e(1413),c=e(12029),g=e(67294),o=e(78733),O=e(4942),i=e(97685),$=e(50756),v=e(46976),p=function(h,M){return g.createElement(v.Z,(0,l.Z)((0,l.Z)({},h),{},{ref:M,icon:$.Z}))},V=g.forwardRef(p),I=e(21770),Z=e(48874),w=e(17093),S=e(26713),r=e(94184),W=e.n(r),C=e(66758),B=e(2514),N=e(98082),q=function(h){var M;return(0,O.Z)({},h.componentCls,{"&-title":{marginBlockEnd:h.marginXL,fontWeight:"bold"},"&-container":(0,O.Z)({flexWrap:"wrap",maxWidth:"100%"},"> div".concat(h.antCls,"-space-item"),{maxWidth:"100%"}),"&-twoLine":(M={display:"block",width:"100%"},(0,O.Z)(M,"".concat(h.componentCls,"-title"),{width:"100%",margin:"8px 0"}),(0,O.Z)(M,"".concat(h.componentCls,"-container"),{paddingInlineStart:16}),(0,O.Z)(M,"".concat(h.antCls,"-space-item,").concat(h.antCls,"-form-item"),{width:"100%"}),(0,O.Z)(M,"".concat(h.antCls,"-form-item"),{"&-control":{display:"flex",alignItems:"center",justifyContent:"flex-end","&-input":{alignItems:"center",justifyContent:"flex-end","&-content":{flex:"none"}}}}),M)})};function G(y){return(0,N.Xj)("ProFormGroup",function(h){var M=(0,l.Z)((0,l.Z)({},h),{},{componentCls:".".concat(y)});return[q(M)]})}var f=e(85893),A=g.forwardRef(function(y,h){var M=g.useContext(C.Z),Q=M.groupProps,x=(0,l.Z)((0,l.Z)({},Q),y),D=x.children,U=x.collapsible,J=x.defaultCollapsed,z=x.style,F=x.labelLayout,H=x.title,a=H===void 0?y.label:H,t=x.tooltip,u=x.align,m=u===void 0?"start":u,n=x.direction,L=x.size,P=L===void 0?32:L,_=x.titleStyle,j=x.titleRender,d=x.spaceProps,s=x.extra,E=x.autoFocus,R=(0,I.Z)(function(){return J||!1},{value:y.collapsed,onChange:y.onCollapse}),T=(0,i.Z)(R,2),X=T[0],ne=T[1],te=(0,g.useContext)(w.ZP.ConfigContext),re=te.getPrefixCls,ie=(0,B.zx)(y),ce=ie.ColWrapper,le=ie.RowWrapper,oe=re("pro-form-group"),me=G(oe),Pe=me.wrapSSR,de=me.hashId,ve=U&&(0,f.jsx)(V,{style:{marginInlineEnd:8},rotate:X?void 0:90}),fe=(0,f.jsx)(Z.G,{label:ve?(0,f.jsxs)("div",{children:[ve,a]}):a,tooltip:t}),he=(0,g.useCallback)(function(ae){var ue=ae.children;return(0,f.jsx)(S.Z,(0,l.Z)((0,l.Z)({},d),{},{className:W()("".concat(oe,"-container ").concat(de),d==null?void 0:d.className),size:P,align:m,direction:n,style:(0,l.Z)({rowGap:0},d==null?void 0:d.style),children:ue}))},[m,oe,n,de,P,d]),ge=j?j(fe,y):fe,_e=(0,g.useMemo)(function(){var ae=[],ue=g.Children.toArray(D).map(function(ee,Me){var pe;return g.isValidElement(ee)&&ee!==null&&ee!==void 0&&(pe=ee.props)!==null&&pe!==void 0&&pe.hidden?(ae.push(ee),null):Me===0&&g.isValidElement(ee)&&E?g.cloneElement(ee,(0,l.Z)((0,l.Z)({},ee.props),{},{autoFocus:E})):ee});return[(0,f.jsx)(le,{Wrapper:he,children:ue},"children"),ae.length>0?(0,f.jsx)("div",{style:{display:"none"},children:ae}):null]},[D,le,he,E]),ye=(0,i.Z)(_e,2),Ee=ye[0],Ce=ye[1];return Pe((0,f.jsx)(ce,{children:(0,f.jsxs)("div",{className:W()(oe,de,(0,O.Z)({},"".concat(oe,"-twoLine"),F==="twoLine")),style:z,ref:h,children:[Ce,(a||t||s)&&(0,f.jsx)("div",{className:"".concat(oe,"-title ").concat(de),style:_,onClick:function(){ne(!X)},children:s?(0,f.jsxs)("div",{style:{display:"flex",width:"100%",alignItems:"center",justifyContent:"space-between"},children:[ge,(0,f.jsx)("span",{onClick:function(ue){return ue.stopPropagation()},children:s})]}):ge}),(0,f.jsx)("div",{style:{display:U&&X?"none":void 0},children:Ee})]})}))});A.displayName="ProForm-Group";var k=A,Y=e(4499);function b(y){return(0,f.jsx)(o.I,(0,l.Z)({layout:"vertical",submitter:{render:function(M,Q){return Q.reverse()}},contentRender:function(M,Q){return(0,f.jsxs)(f.Fragment,{children:[M,Q]})}},y))}b.Group=k,b.useForm=c.Z.useForm,b.Item=Y.Z,b.useWatch=c.Z.useWatch,b.ErrorList=c.Z.ErrorList,b.Provider=c.Z.Provider,b.useFormInstance=c.Z.useFormInstance},23809:function(se,K,e){e.d(K,{$:function(){return $}});var l=e(97857),c=e.n(l),g=e(64317),o=e(35312),O=e(67294),i=e(85893);function $(v){var p,V=(0,o.useIntl)(),I=(0,o.useModel)("mapModel"),Z=I.run,w=I.options,S=I.loading,r=I.initialValue;return O.useEffect(function(){Z()},[]),(0,i.jsx)(g.Z,c()(c()({},v),{},{rules:[{required:!0,message:V.formatMessage({id:"pages.device-manage.track.map.required",defaultMessage:"\u8BF7\u9009\u62E9\u5730\u56FE"})}],width:"lg",name:"mapId",style:{width:240},fieldProps:{loading:S},initialValue:(p=v.initialValue)!==null&&p!==void 0?p:r,options:w}))}},38943:function(se,K,e){e.r(K),e.d(K,{default:function(){return x}});var l=e(5574),c=e.n(l),g=e(97857),o=e.n(g),O=e(19632),i=e.n(O),$=e(87888),v=e(32240),p=e(45968),V=e(30692),I=e(92138),Z=e(62466),w=e(4393),S=e(96486),r=e(67294),W=e(67058),C=e(85893),B={Equipment:I.Q6,Personnel:I.ek,Vehicle:I.EV,Stuff:I.iN};function N(D){var U,J=c()(D.rect,2),z=J[0],F=J[1],H=r.useState(),a=c()(H,2),t=a[0],u=a[1],m=r.useRef(null),n=r.useRef(),L=r.useRef(),P=r.useRef(),_=r.useRef({});return r.useEffect(function(){var j;n.current=new Z.Scene({id:m.current,logoVisible:!1,map:new Z.Mapbox({style:"blank",center:[0,0],pitch:0,zoom:20,minZoom:18})}),n.current.addImage("stationIcon",p.Z),n.current.addImage("arrow",$.Z),n.current.addImage("personImage",v.Z),n.current.addImage("warning",V.Z),(j=n.current)===null||j===void 0||j.on("loaded",function(){return u(!0)})},[]),r.useEffect(function(){if(D.map&&t&&F&&z){var j=(0,Z.metersToLngLat)([z*W.bA,F*W.bA]);if(L.current)L.current.setData(D.map,{parser:{type:"image",extent:[0,0].concat(i()(j))}}),L.current.setIndex(0);else{var d,s;L.current=new Z.ImageLayer({zIndex:0}),L.current.source(D.map,{parser:{type:"image",extent:[0,0].concat(i()(j))}}),(d=n.current)===null||d===void 0||d.setCenter([j[0]/2,j[1]/2]),(s=n.current)===null||s===void 0||s.addLayer(L.current)}}},[D.map,t,F,z]),r.useEffect(function(){if(t&&F&&!(0,S.isEmpty)(D.stations)){var j,d,s=(j=(d=D.stations)!==null&&d!==void 0?d:[])===null||j===void 0?void 0:j.map(function(R){var T=(0,W.qS)([R.setX,R.setY],F),X=c()(T,2),ne=X[0],te=X[1];return o()(o()({},R),{},{lng:ne,lat:te})});if(P.current)P.current.setData(s),P.current.setIndex(3);else{var E;P.current=new Z.PointLayer({zIndex:3}).source(s,{parser:{type:"json",x:"lng",y:"lat",name:"name"}}).shape("name",["stationIcon"]).size(10),(E=n.current)===null||E===void 0||E.addLayer(P.current)}}},[D.stations,t,F]),r.useEffect(function(){if(t&&F){var j,d=(0,S.chain)((j=D.beacons)!==null&&j!==void 0?j:[]).groupBy(function(s){return s.type}).mapValues(function(s){return(0,S.chain)(s).countBy(function(E){var R,T;return"".concat((R=E.posX)===null||R===void 0?void 0:R.toFixed(1),"-").concat((T=E.posY)===null||T===void 0?void 0:T.toFixed(1))}).map(function(E,R){var T=R.split("-").map(Number),X=c()(T,2),ne=X[0],te=X[1],re=(0,W.qS)([ne,te],F),ie=c()(re,2),ce=ie[0],le=ie[1];return{lng:ce,lat:le,sum:E}}).value()}).value();(0,S.forEach)(["Equipment","Personnel","Vehicle","Stuff"],function(s){var E;if((E=_.current)!==null&&E!==void 0&&E[s]){var T;_.current[s].setData(d[s]),(T=_.current[s])===null||T===void 0||T.show(),_.current[s].setIndex(4)}else{var R;_.current[s]=new Z.HeatmapLayer({name:"heat-map-Equipment-layer"}).source(d[s],{parser:{type:"json",x:"lng",y:"lat"}}).shape("heatmap").size("sum",[0,1]).style({intensity:2,radius:20,rampColors:{colors:[B[s][2],B[s][3],B[s][4],B[s][5],B[s][7],B[s][9]].reverse(),positions:[0,.2,.4,.6,.8,1]}}),(R=n.current)===null||R===void 0||R.addLayer(_.current[s])}})}},[D.beacons,t,F]),(0,C.jsx)(r.Fragment,{children:(0,C.jsx)(w.Z,{bodyStyle:{padding:0},children:(0,C.jsx)("div",{id:"map",ref:m,style:{minHeight:(U=D.height)!==null&&U!==void 0?U:600}})})})}var q=e(23809),G=e(84140),f=e(491),A=e(69851),k=e(90930),Y=e(28199),b=e(34994),y=e(78844),h=e(35312),M=e(27484),Q=e.n(M);function x(){var D,U,J,z=(0,h.useIntl)(),F=r.useRef(),H=(0,h.useRequest)(f.FU,{manual:!0,formatResult:function(s){return s}}),a=H.run,t=H.data,u=(0,h.useRequest)(G.uz,{manual:!0}),m=u.run,n=u.data,L=(0,h.useRequest)(G.s_,{manual:!0,formatResult:function(s){return s}}),P=L.run,_=L.data;function j(d){var s=d.mapId;return a({mapId:s}).then(function(){return m({mapId:s})}).then(function(){return P(d)}).then(function(E){return E.code===A.OK})}return(0,C.jsxs)(k._z,{childrenContentStyle:{padding:20},children:[(0,C.jsx)(Y.Z,{children:(0,C.jsxs)(b.A,{submitter:{resetButtonProps:{style:{display:"none"}}},formRef:F,layout:"inline",style:{minWidth:320},onFinish:function(s){return j(s)},children:[(0,C.jsx)(q.$,{}),(0,C.jsx)(y.Z,{name:"range",transform:function(s){var E,R,T,X=(E=(0,A.G$)(s))!==null&&E!==void 0?E:[],ne=c()(X,2),te=ne[0],re=ne[1];return{startTime:te?(R=Q()(te))===null||R===void 0?void 0:R.unix():void 0,endTime:re?(T=Q()(re))===null||T===void 0?void 0:T.unix():void 0}},placeholder:[z.formatMessage({id:"pages.position-manage.tracking-manage.start.time",defaultMessage:"\u8BF7\u9009\u62E9\u8D77\u59CB\u65F6\u95F4"}),z.formatMessage({id:"pages.position-manage.tracking-manage.end.time",defaultMessage:"\u8BF7\u9009\u62E9\u7ED3\u675F\u65F6\u95F4"})]})]})}),(0,C.jsx)(w.Z,{style:{marginTop:12},children:(0,C.jsx)(N,{map:t==null||(D=t.data)===null||D===void 0?void 0:D.picture,rect:[t==null||(U=t.data)===null||U===void 0?void 0:U.length,t==null||(J=t.data)===null||J===void 0?void 0:J.width],stations:n==null?void 0:n.items,beacons:_==null?void 0:_.data})})]})}},84140:function(se,K,e){e.d(K,{$h:function(){return S},Ig:function(){return B},TB:function(){return F},Um:function(){return D},WN:function(){return h},Zc:function(){return q},_s:function(){return k},aL:function(){return J},bD:function(){return b},s_:function(){return Q},uz:function(){return f},x2:function(){return W}});var l=e(13769),c=e.n(l),g=e(15009),o=e.n(g),O=e(97857),i=e.n(O),$=e(99289),v=e.n($),p=e(35312),V=["deviceId"],I=["deviceId"],Z=["gateway"],w=["gateway"];function S(a,t){return r.apply(this,arguments)}function r(){return r=v()(o()().mark(function a(t,u){return o()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,p.request)("/api/v1/beacon",i()({method:"GET",params:i()({current:"1",size:"10"},t)},u||{})));case 1:case"end":return n.stop()}},a)})),r.apply(this,arguments)}function W(a,t){return C.apply(this,arguments)}function C(){return C=v()(o()().mark(function a(t,u){return o()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,p.request)("/api/v1/beacon",i()({method:"POST",headers:{"Content-Type":"application/json"},data:t},u||{})));case 1:case"end":return n.stop()}},a)})),C.apply(this,arguments)}function B(a,t,u){return N.apply(this,arguments)}function N(){return N=v()(o()().mark(function a(t,u,m){var n,L;return o()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return n=t.deviceId,L=c()(t,V),_.abrupt("return",(0,p.request)("/api/v1/beacon/".concat(n),i()({method:"PUT",headers:{"Content-Type":"application/json"},params:i()({},L),data:u},m||{})));case 2:case"end":return _.stop()}},a)})),N.apply(this,arguments)}function q(a,t){return G.apply(this,arguments)}function G(){return G=v()(o()().mark(function a(t,u){var m,n;return o()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return m=t.deviceId,n=c()(t,I),P.abrupt("return",(0,p.request)("/api/v1/beacon/".concat(m),i()({method:"DELETE",params:i()({},n)},u||{})));case 2:case"end":return P.stop()}},a)})),G.apply(this,arguments)}function f(a,t){return A.apply(this,arguments)}function A(){return A=v()(o()().mark(function a(t,u){return o()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,p.request)("/api/v1/gateway",i()({method:"GET",params:i()({current:"1",size:"10"},t)},u||{})));case 1:case"end":return n.stop()}},a)})),A.apply(this,arguments)}function k(a,t){return Y.apply(this,arguments)}function Y(){return Y=v()(o()().mark(function a(t,u){return o()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,p.request)("/api/v1/gateway",i()({method:"POST",headers:{"Content-Type":"application/json"},data:t},u||{})));case 1:case"end":return n.stop()}},a)})),Y.apply(this,arguments)}function b(a,t){return y.apply(this,arguments)}function y(){return y=v()(o()().mark(function a(t,u){var m,n;return o()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return m=t.gateway,n=c()(t,Z),P.abrupt("return",(0,p.request)("/api/v1/gateway/".concat(m),i()({method:"DELETE",params:i()({},n)},u||{})));case 2:case"end":return P.stop()}},a)})),y.apply(this,arguments)}function h(a,t,u){return M.apply(this,arguments)}function M(){return M=v()(o()().mark(function a(t,u,m){var n,L;return o()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return n=t.gateway,L=c()(t,w),_.abrupt("return",(0,p.request)("/api/v1/gateway".concat(n),i()({method:"PUT",headers:{"Content-Type":"application/json"},params:i()({},L),data:u},m||{})));case 2:case"end":return _.stop()}},a)})),M.apply(this,arguments)}function Q(a,t){return x.apply(this,arguments)}function x(){return x=v()(o()().mark(function a(t,u){return o()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,p.request)("/api/v1/location",i()({method:"GET",params:i()({},t)},u||{})));case 1:case"end":return n.stop()}},a)})),x.apply(this,arguments)}function D(a,t){return U.apply(this,arguments)}function U(){return U=v()(o()().mark(function a(t,u){return o()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,p.request)("/api/v1/status/beacon",i()({method:"GET",params:i()({},t)},u||{})));case 1:case"end":return n.stop()}},a)})),U.apply(this,arguments)}function J(a,t){return z.apply(this,arguments)}function z(){return z=v()(o()().mark(function a(t,u){return o()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,p.request)("/api/v1/status/gateway",i()({method:"GET",params:i()({},t)},u||{})));case 1:case"end":return n.stop()}},a)})),z.apply(this,arguments)}function F(a,t){return H.apply(this,arguments)}function H(){return H=v()(o()().mark(function a(t,u){return o()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,p.request)("/api/v1/unbound/beacon",i()({method:"GET",params:i()({},t)},u||{})));case 1:case"end":return n.stop()}},a)})),H.apply(this,arguments)}}}]);
