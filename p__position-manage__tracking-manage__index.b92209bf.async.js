"use strict";(self.webpackChunkheyanai_navigation=self.webpackChunkheyanai_navigation||[]).push([[478],{78844:function(ee,x,e){var g=e(1413),d=e(91),W=e(86190),r=e(67294),A=e(66758),u=e(97556),L=e(85893),c=["fieldProps","proFieldProps"],i="dateTimeRange",R=r.forwardRef(function(E,y){var S=E.fieldProps,D=E.proFieldProps,n=(0,d.Z)(E,c),P=(0,r.useContext)(A.Z);return(0,L.jsx)(u.Z,(0,g.Z)({ref:y,fieldProps:(0,g.Z)({getPopupContainer:P.getPopupContainer},S),valueType:i,proFieldProps:D,filedConfig:{valueType:i,customLightMode:!0,lightFilterLabelFormatter:function(U){return(0,W.c)(U,"YYYY-MM-DD HH:mm:ss")}}},n))});x.Z=R},64317:function(ee,x,e){var g=e(1413),d=e(91),W=e(22270),r=e(67294),A=e(66758),u=e(97556),L=e(85893),c=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],i=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],R=r.forwardRef(function(n,P){var l=n.fieldProps,U=n.children,O=n.params,j=n.proFieldProps,b=n.mode,K=n.valueEnum,M=n.request,$=n.showSearch,z=n.options,w=(0,d.Z)(n,c),B=(0,r.useContext)(A.Z);return(0,L.jsx)(u.Z,(0,g.Z)((0,g.Z)({valueEnum:(0,W.h)(K),request:M,params:O,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,g.Z)({options:z,mode:b,showSearch:$,getPopupContainer:B.getPopupContainer},l),ref:P,proFieldProps:j},w),{},{children:U}))}),E=r.forwardRef(function(n,P){var l=n.fieldProps,U=n.children,O=n.params,j=n.proFieldProps,b=n.mode,K=n.valueEnum,M=n.request,$=n.options,z=(0,d.Z)(n,i),w=(0,g.Z)({options:$,mode:b||"multiple",labelInValue:!0,showSearch:!0,showArrow:!1,autoClearSearchValue:!0,optionLabelProp:"label"},l),B=(0,r.useContext)(A.Z);return(0,L.jsx)(u.Z,(0,g.Z)((0,g.Z)({valueEnum:(0,W.h)(K),request:M,params:O,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,g.Z)({getPopupContainer:B.getPopupContainer},w),ref:P,proFieldProps:j},z),{},{children:U}))}),y=R,S=E,D=y;D.SearchSelect=S,D.displayName="ProFormComponent",x.Z=D},23809:function(ee,x,e){e.d(x,{$:function(){return L}});var g=e(97857),d=e.n(g),W=e(64317),r=e(80854),A=e(67294),u=e(85893);function L(c){var i,R=(0,r.useIntl)(),E=(0,r.useModel)("mapModel"),y=E.run,S=E.options,D=E.loading,n=E.initialValue;return A.useEffect(function(){y()},[]),(0,u.jsx)(W.Z,d()(d()({},c),{},{rules:[{required:!0,message:R.formatMessage({id:"pages.device-manage.track.map.required",defaultMessage:"\u8BF7\u9009\u62E9\u5730\u56FE"})}],width:"lg",name:"mapId",style:{width:240},fieldProps:{loading:D},initialValue:(i=c.initialValue)!==null&&i!==void 0?i:n,options:S}))}},75888:function(ee,x,e){e.d(x,{Z:function(){return y},l:function(){return S}});var g=e(15009),d=e.n(g),W=e(99289),r=e.n(W),A=e(97857),u=e.n(A),L=e(84140),c=e(69851),i=e(64317),R=e(80854),E=e(85893);function y(D){var n=(0,R.useIntl)(),P=(0,R.useRequest)(L.TB,{manual:!0,formatResult:function(O){var j,b,K=(j=(b=O.data)===null||b===void 0?void 0:b.map(function(M){return{label:M.deviceId,value:M.deviceId,key:M.deviceId}}))!==null&&j!==void 0?j:[];return K}}),l=P.run;return(0,E.jsx)(i.Z,u()({label:n.formatMessage({id:"pages.personnel-manage.organization.department.person.tag",defaultMessage:"\u7ED1\u5B9A\u6807\u7B7E"}),request:function(){return l({})}},D))}function S(D){var n=(0,R.useIntl)();return(0,E.jsx)(i.Z,u()({request:function(){var P=r()(d()().mark(function l(U){var O,j,b,K,M,$;return d()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return b=U.keyWords,K=b===void 0?"":b,w.next=3,(0,L.$h)({current:"1",size:"20",name:K});case 3:return M=w.sent,$=(O=(j=(0,c.LF)(M).data)===null||j===void 0?void 0:j.map(function(B){return{label:B.name,value:B.deviceId,key:B.deviceId}}))!==null&&O!==void 0?O:[],w.abrupt("return",$);case 6:case"end":return w.stop()}},l)}));return function(l){return P.apply(this,arguments)}}(),placeholder:n.formatMessage({id:"pages.personnel-manage.organization.department.person.tag.placeholder",defaultMessage:"\u8BF7\u9009\u62E9\u6807\u7B7E"}),rules:[{required:!0,message:n.formatMessage({id:"pages.device-manage.track.beacon.required",defaultMessage:"\u8BF7\u9009\u62E9\u6807\u7B7E"})}],fieldProps:{showSearch:!0,style:{minWidth:180}}},D))}},76403:function(ee,x,e){e.r(x),e.d(x,{default:function(){return te}});var g=e(5574),d=e.n(g),W=e(97857),r=e.n(W),A=e(19632),u=e.n(A),L=e(87888),c=e(32240),i=e(45968),R=e(30692),E=e(92138),y=e(63060),S=e(4393),D=e(96486),n=e(67294),P=e(67058),l=e(85893);function U(h){var F,H=d()(h.rect,2),V=H[0],T=H[1],N=n.useState(),s=d()(N,2),t=s[0],o=s[1],p=n.useRef(null),a=n.useRef(),C=n.useRef(),f=n.useRef(),v=n.useRef(),Y=n.useRef();return n.useEffect(function(){var m;a.current=new y.Scene({id:p.current,logoVisible:!1,map:new y.Mapbox({style:"blank",center:[0,0],pitch:0,zoom:20,minZoom:18})}),a.current.addImage("stationIcon",i.Z),a.current.addImage("arrow",L.Z),a.current.addImage("personImage",c.Z),a.current.addImage("warning",R.Z),(m=a.current)===null||m===void 0||m.on("loaded",function(){return o(!0)})},[]),n.useEffect(function(){if(h.map&&t&&T&&V){var m=(0,y.metersToLngLat)([V*P.bA,T*P.bA]);if(C.current)C.current.setData(h.map,{parser:{type:"image",extent:[0,0].concat(u()(m))}}),C.current.setIndex(0);else{var _,I;C.current=new y.ImageLayer({zIndex:0}),C.current.source(h.map,{parser:{type:"image",extent:[0,0].concat(u()(m))}}),(_=a.current)===null||_===void 0||_.setCenter([m[0]/2,m[1]/2]),(I=a.current)===null||I===void 0||I.addLayer(C.current)}}},[h.map,t,T,V]),n.useEffect(function(){if(t&&T&&!(0,D.isEmpty)(h.stations)){var m,_,I=(m=(_=h.stations)!==null&&_!==void 0?_:[])===null||m===void 0?void 0:m.map(function(Z){var Q=(0,P.qS)([Z.setX,Z.setY],T),X=d()(Q,2),q=X[0],J=X[1];return r()(r()({},Z),{},{lng:q,lat:J})});if(f.current)f.current.setData(I),f.current.setIndex(3);else{var G;f.current=new y.PointLayer({zIndex:3}).source(I,{parser:{type:"json",x:"lng",y:"lat",name:"name"}}).shape("name",["stationIcon"]).size(10),(G=a.current)===null||G===void 0||G.addLayer(f.current)}}},[h.stations,t,T]),n.useEffect(function(){if(t&&T){for(var m,_=(m=h.beacons)!==null&&m!==void 0?m:[],I=_==null?void 0:_.map(function(ue){var pe=(0,P.qS)([ue.posX,ue.posY],T),ie=d()(pe,2),ve=ie[0],he=ie[1];return r()(r()({},ue),{},{lng:ve,lat:he})}),G=[],Z=0;Z<_.length;Z++){var Q=_[Z],X=_[Z+1];if(X){var q=(0,P.qS)([Q.posX,Q.posY],T),J=d()(q,2),le=J[0],_e=J[1],de=(0,P.qS)([X.posX,X.posY],T),oe=d()(de,2),ce=oe[0],me=oe[1];G.push(r()(r()({},Q),{},{lng:le,lat:_e,lng1:ce,lat1:me}))}}if(v.current)(0,D.isEmpty)(h.beacons)?v.current.hide():(v.current.show(),v.current.setData(G),v.current.setIndex(3));else{var re;v.current=new y.LineLayer({zIndex:3}).source(G,{parser:{type:"json",x:"lng",y:"lat",x1:"lng1",y1:"lat1"}}).shape("line").size(2).color(E.ek[3]).animate({interval:.4,duration:1,trailLength:.8}).style({lineTexture:!0,iconStep:20}),(re=a.current)===null||re===void 0||re.addLayer(v.current)}if(Y.current)(0,D.isEmpty)(h.beacons)?Y.current.hide():(Y.current.show(),Y.current.setData(I),Y.current.setIndex(4));else{var se;Y.current=new y.PointLayer({zIndex:4}).source(I,{parser:{type:"json",x:"lng",y:"lat",name:"name"}}).shape("circle").color(E.ek[3]).size(5),(se=a.current)===null||se===void 0||se.addLayer(Y.current)}}},[h.beacons,t,T]),(0,l.jsx)(n.Fragment,{children:(0,l.jsx)(S.Z,{bodyStyle:{padding:0},children:(0,l.jsx)("div",{id:"map",ref:p,style:{minHeight:(F=h.height)!==null&&F!==void 0?F:600}})})})}var O=e(23809),j=e(75888),b=e(84140),K=e(491),M=e(69851),$=e(90930),z=e(28199),w=e(57470),B=e(78844),k=e(80854),ae=e(27484),ne=e.n(ae);function te(){var h,F,H,V=(0,k.useIntl)(),T=n.useRef(),N=(0,k.useRequest)(K.FU,{manual:!0,formatResult:function(_){return _}}),s=N.run,t=N.data,o=(0,k.useRequest)(b.uz,{manual:!0}),p=o.run,a=o.data,C=(0,k.useRequest)(b.s_,{manual:!0,formatResult:function(_){return _}}),f=C.run,v=C.data;function Y(m){var _=m.mapId;return s({mapId:_}).then(function(){return p({mapId:_})}).then(function(){return f(m)}).then(function(I){return I.code===M.OK})}return(0,l.jsxs)($._z,{childrenContentStyle:{padding:20},children:[(0,l.jsx)(z.Z,{children:(0,l.jsxs)(w.t,{submitter:{resetButtonProps:{style:{display:"none"}}},formRef:T,layout:"vertical",span:6,onFinish:function(_){return Y(_)},children:[(0,l.jsx)(O.$,{}),(0,l.jsx)(j.l,{name:"deviceId"}),(0,l.jsx)(B.Z,{name:"range",transform:function(_){var I,G,Z,Q=(I=(0,M.G$)(_))!==null&&I!==void 0?I:[],X=d()(Q,2),q=X[0],J=X[1];return{startTime:q?(G=ne()(q))===null||G===void 0?void 0:G.unix():void 0,endTime:J?(Z=ne()(J))===null||Z===void 0?void 0:Z.unix():void 0}},placeholder:[V.formatMessage({id:"pages.position-manage.tracking-manage.start.time",defaultMessage:"\u8BF7\u9009\u62E9\u8D77\u59CB\u65F6\u95F4"}),V.formatMessage({id:"pages.position-manage.tracking-manage.end.time",defaultMessage:"\u8BF7\u9009\u62E9\u7ED3\u675F\u65F6\u95F4"})]})]})}),(0,l.jsx)(S.Z,{style:{marginTop:12},children:(0,l.jsx)(U,{map:t==null||(h=t.data)===null||h===void 0?void 0:h.picture,rect:[t==null||(F=t.data)===null||F===void 0?void 0:F.length,t==null||(H=t.data)===null||H===void 0?void 0:H.width],stations:a==null?void 0:a.items,beacons:v==null?void 0:v.data})})]})}},84140:function(ee,x,e){e.d(x,{$h:function(){return D},Ig:function(){return U},TB:function(){return T},Um:function(){return h},WN:function(){return k},Zc:function(){return j},_s:function(){return $},aL:function(){return H},bD:function(){return w},s_:function(){return ne},uz:function(){return K},x2:function(){return P}});var g=e(13769),d=e.n(g),W=e(15009),r=e.n(W),A=e(97857),u=e.n(A),L=e(99289),c=e.n(L),i=e(80854),R=["deviceId"],E=["deviceId"],y=["gateway"],S=["gateway"];function D(s,t){return n.apply(this,arguments)}function n(){return n=c()(r()().mark(function s(t,o){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,i.request)("/api/v1/beacon",u()({method:"GET",params:u()({current:"1",size:"10"},t)},o||{})));case 1:case"end":return a.stop()}},s)})),n.apply(this,arguments)}function P(s,t){return l.apply(this,arguments)}function l(){return l=c()(r()().mark(function s(t,o){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,i.request)("/api/v1/beacon",u()({method:"POST",headers:{"Content-Type":"application/json"},data:t},o||{})));case 1:case"end":return a.stop()}},s)})),l.apply(this,arguments)}function U(s,t,o){return O.apply(this,arguments)}function O(){return O=c()(r()().mark(function s(t,o,p){var a,C;return r()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return a=t.deviceId,C=d()(t,R),v.abrupt("return",(0,i.request)("/api/v1/beacon/".concat(a),u()({method:"PUT",headers:{"Content-Type":"application/json"},params:u()({},C),data:o},p||{})));case 2:case"end":return v.stop()}},s)})),O.apply(this,arguments)}function j(s,t){return b.apply(this,arguments)}function b(){return b=c()(r()().mark(function s(t,o){var p,a;return r()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return p=t.deviceId,a=d()(t,E),f.abrupt("return",(0,i.request)("/api/v1/beacon/".concat(p),u()({method:"DELETE",params:u()({},a)},o||{})));case 2:case"end":return f.stop()}},s)})),b.apply(this,arguments)}function K(s,t){return M.apply(this,arguments)}function M(){return M=c()(r()().mark(function s(t,o){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,i.request)("/api/v1/gateway",u()({method:"GET",params:u()({current:"1",size:"10"},t)},o||{})));case 1:case"end":return a.stop()}},s)})),M.apply(this,arguments)}function $(s,t){return z.apply(this,arguments)}function z(){return z=c()(r()().mark(function s(t,o){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,i.request)("/api/v1/gateway",u()({method:"POST",headers:{"Content-Type":"application/json"},data:t},o||{})));case 1:case"end":return a.stop()}},s)})),z.apply(this,arguments)}function w(s,t){return B.apply(this,arguments)}function B(){return B=c()(r()().mark(function s(t,o){var p,a;return r()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return p=t.gateway,a=d()(t,y),f.abrupt("return",(0,i.request)("/api/v1/gateway/".concat(p),u()({method:"DELETE",params:u()({},a)},o||{})));case 2:case"end":return f.stop()}},s)})),B.apply(this,arguments)}function k(s,t,o){return ae.apply(this,arguments)}function ae(){return ae=c()(r()().mark(function s(t,o,p){var a,C;return r()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return a=t.gateway,C=d()(t,S),v.abrupt("return",(0,i.request)("/api/v1/gateway".concat(a),u()({method:"PUT",headers:{"Content-Type":"application/json"},params:u()({},C),data:o},p||{})));case 2:case"end":return v.stop()}},s)})),ae.apply(this,arguments)}function ne(s,t){return te.apply(this,arguments)}function te(){return te=c()(r()().mark(function s(t,o){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,i.request)("/api/v1/location",u()({method:"GET",params:u()({},t)},o||{})));case 1:case"end":return a.stop()}},s)})),te.apply(this,arguments)}function h(s,t){return F.apply(this,arguments)}function F(){return F=c()(r()().mark(function s(t,o){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,i.request)("/api/v1/status/beacon",u()({method:"GET",params:u()({},t)},o||{})));case 1:case"end":return a.stop()}},s)})),F.apply(this,arguments)}function H(s,t){return V.apply(this,arguments)}function V(){return V=c()(r()().mark(function s(t,o){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,i.request)("/api/v1/status/gateway",u()({method:"GET",params:u()({},t)},o||{})));case 1:case"end":return a.stop()}},s)})),V.apply(this,arguments)}function T(s,t){return N.apply(this,arguments)}function N(){return N=c()(r()().mark(function s(t,o){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,i.request)("/api/v1/unbound/beacon",u()({method:"GET",params:u()({},t)},o||{})));case 1:case"end":return a.stop()}},s)})),N.apply(this,arguments)}}}]);
